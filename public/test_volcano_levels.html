<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«å±±APIçº§åˆ«æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .word-result {
            margin: 10px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 3px;
        }
        .level-high {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        .level-medium {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }
        .level-low {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976d2;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        .error {
            color: #f44336;
            background: #ffebee;
            padding: 10px;
            border-radius: 5px;
        }
        .stats {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¥ ç«å±±APIçº§åˆ«åŒ¹é…æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•å•è¯</h2>
        <p>æµ‹è¯•ä¸€äº›å¸¸è§å•è¯çš„çº§åˆ«åˆ¤æ–­ï¼š</p>
        <button onclick="testCommonWords()">æµ‹è¯•å¸¸è§å•è¯</button>
        <button onclick="testDifficultWords()">æµ‹è¯•å›°éš¾å•è¯</button>
        <button onclick="testMixedWords()">æµ‹è¯•æ··åˆå•è¯</button>
        <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
    </div>

    <div class="stats" id="stats" style="display: none;">
        <h3>ç»Ÿè®¡ä¿¡æ¯</h3>
        <div id="statsContent"></div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•ç»“æœ</h2>
        <div id="results"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';
        
        // æµ‹è¯•å•è¯ç»„
        const testWordsData = {
            common: ['the', 'and', 'is', 'in', 'to', 'have', 'it', 'for', 'not', 'on'],
            difficult: ['sophisticated', 'phenomenon', 'paradigm', 'ubiquitous', 'serendipity', 'ephemeral', 'quintessential', 'perspicacious', 'magnanimous', 'ineffable'],
            mixed: ['cat', 'beautiful', 'understand', 'sophisticated', 'run', 'magnificent', 'simple', 'extraordinary', 'book', 'incomprehensible']
        };

        async function testWords(words, category) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML += `<h3>æµ‹è¯• ${category} å•è¯</h3>`;
            
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'loading';
            loadingDiv.textContent = `æ­£åœ¨æµ‹è¯• ${words.length} ä¸ªå•è¯...`;
            resultsDiv.appendChild(loadingDiv);

            try {
                // ä½¿ç”¨å¢å¼ºç¿»è¯‘APIæµ‹è¯•
                const response = await fetch(`${API_BASE}/api/enhanced/paragraph`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: words.join(' '),
                        options: {
                            difficultyThreshold: 1, // æ˜¾ç¤ºæ‰€æœ‰çº§åˆ«
                            timeouts: {
                                paragraph: 30000,
                                volcanoModel: 30000
                            }
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                loadingDiv.remove();

                if (result.success && result.data.wordProcessing) {
                    displayWordResults(result.data.wordProcessing, category);
                    updateStats(result.data.wordProcessing, category);
                } else {
                    throw new Error(result.message || 'æœªçŸ¥é”™è¯¯');
                }

            } catch (error) {
                loadingDiv.remove();
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error';
                errorDiv.textContent = `æµ‹è¯•å¤±è´¥: ${error.message}`;
                resultsDiv.appendChild(errorDiv);
            }
        }

        function displayWordResults(wordProcessing, category) {
            const resultsDiv = document.getElementById('results');
            
            // æ˜¾ç¤ºæ‰€æœ‰å¤„ç†çš„å•è¯
            const allWords = [
                ...(wordProcessing.databaseMatched || []),
                ...(wordProcessing.newWordsProcessed || [])
            ];

            if (allWords.length === 0) {
                const noResultsDiv = document.createElement('div');
                noResultsDiv.className = 'word-result';
                noResultsDiv.textContent = 'æ²¡æœ‰æ‰¾åˆ°å•è¯ç»“æœ';
                resultsDiv.appendChild(noResultsDiv);
                return;
            }

            allWords.forEach(word => {
                const wordDiv = document.createElement('div');
                wordDiv.className = 'word-result';
                
                // æ ¹æ®çº§åˆ«è®¾ç½®æ ·å¼
                if (word.difficulty_level >= 6) {
                    wordDiv.classList.add('level-high');
                } else if (word.difficulty_level >= 3) {
                    wordDiv.classList.add('level-medium');
                } else {
                    wordDiv.classList.add('level-low');
                }

                wordDiv.innerHTML = `
                    <strong>${word.english}</strong> â†’ ${word.chinese || 'æ— ç¿»è¯‘'}
                    <br>
                    <small>
                        çº§åˆ«: ${word.difficulty_level || 'æœªçŸ¥'} | 
                        æ¥æº: ${word.source || 'æœªçŸ¥'} |
                        éŸ³æ ‡: ${word.phonetic || 'æ— '}
                    </small>
                `;
                resultsDiv.appendChild(wordDiv);
            });

            // æ˜¾ç¤ºæ˜¾ç¤ºçš„å•è¯ï¼ˆæ ¹æ®é˜ˆå€¼è¿‡æ»¤åçš„ï¼‰
            if (wordProcessing.displayedWords && wordProcessing.displayedWords.length > 0) {
                const displayedDiv = document.createElement('div');
                displayedDiv.className = 'stats';
                displayedDiv.innerHTML = `
                    <h4>æ ¹æ®é˜ˆå€¼æ˜¾ç¤ºçš„å•è¯ (${wordProcessing.displayedWords.length}ä¸ª)</h4>
                    ${wordProcessing.displayedWords.map(w => `${w.english}(${w.difficulty_level})`).join(', ')}
                `;
                resultsDiv.appendChild(displayedDiv);
            }
        }

        function updateStats(wordProcessing, category) {
            const statsDiv = document.getElementById('stats');
            const statsContent = document.getElementById('statsContent');
            
            const allWords = [
                ...(wordProcessing.databaseMatched || []),
                ...(wordProcessing.newWordsProcessed || [])
            ];

            // ç»Ÿè®¡çº§åˆ«åˆ†å¸ƒ
            const levelCounts = {};
            allWords.forEach(word => {
                const level = word.difficulty_level || 0;
                levelCounts[level] = (levelCounts[level] || 0) + 1;
            });

            const statsHtml = `
                <h4>${category} å•è¯ç»Ÿè®¡</h4>
                <p>æ€»å•è¯æ•°: ${allWords.length}</p>
                <p>æ˜¾ç¤ºå•è¯æ•°: ${wordProcessing.displayedWords?.length || 0}</p>
                <p>çº§åˆ«åˆ†å¸ƒ:</p>
                <ul>
                    ${Object.entries(levelCounts)
                        .sort(([a], [b]) => parseInt(a) - parseInt(b))
                        .map(([level, count]) => `<li>çº§åˆ« ${level}: ${count} ä¸ªå•è¯</li>`)
                        .join('')}
                </ul>
                <p>æ•°æ®åº“åŒ¹é…: ${wordProcessing.databaseMatched?.length || 0} ä¸ª</p>
                <p>æ–°å¤„ç†å•è¯: ${wordProcessing.newWordsProcessed?.length || 0} ä¸ª</p>
            `;

            statsContent.innerHTML += statsHtml;
            statsDiv.style.display = 'block';
        }

        function testCommonWords() {
            testWords(testWordsData.common, 'å¸¸è§');
        }

        function testDifficultWords() {
            testWords(testWordsData.difficult, 'å›°éš¾');
        }

        function testMixedWords() {
            testWords(testWordsData.mixed, 'æ··åˆ');
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('stats').style.display = 'none';
            document.getElementById('statsContent').innerHTML = '';
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºAPIé…ç½®
        window.onload = function() {
            console.log('API Base URL:', API_BASE);
            console.log('æµ‹è¯•é¡µé¢å·²åŠ è½½');
        };
    </script>
</body>
</html>