# 项目部署指南

## 部署准备

### 已完成步骤
- ✅ 项目构建成功，构建文件位于 `dist` 目录
- ✅ EdgeOne Pages配置文件 `edgeone.json` 已配置
- ✅ 边缘函数已编写完成，位于 `edge-functions` 目录

## EdgeOne Pages部署步骤

### 1. 部署环境变量配置

在EdgeOne Pages控制台中设置以下环境变量：

### 1.1 腾讯翻译API配置
- `TENCENT_SECRET_ID`: 腾讯云 API 密钥 SecretId
- `TENCENT_SECRET_KEY`: 腾讯云 API 密钥 SecretKey

### 1.2 数据存储配置
- `KV_URL`: KV存储地址
- `KV_REST_API_URL`: KV REST API地址
- `KV_REST_API_TOKEN`: KV REST API令牌
- `KV_REST_API_READ_ONLY_TOKEN`: KV REST API只读令牌

### 2. 部署方式

#### 方式一：通过关联 Git 仓库自动部署（强烈推荐）
1.  在 EdgeOne Pages 控制台创建一个新项目。
2.  选择“关联 Git 仓库”并授权访问你的 GitHub 账户。
3.  选择 `cloze-test-essay-system` 仓库。
4.  **生产分支**选择 `feature/current-changes`（或者你最终合并到的主分支）。
5.  **构建命令**填写 `npm run build`。
6.  **构建输出目录**填写 `dist`。
7.  在“高级设置”中，确保“Edge Functions 目录”指向 `edge-functions`。
8.  保存并部署。此后，每次推送到该分支都会自动触发部署。

#### 方式二：通过 EdgeOne CLI 手动部署
```bash
# 安装 EdgeOne CLI（如果尚未安装）
# 注意：这里的包名是示例，请根据腾讯云官方文档确认
npm install -g @tencentcloud/cli

# 登录 EdgeOne
# 请根据官方文档指引进行登录配置
tccli edgeone login

# 部署整个项目
# 这个命令会根据 edgeone.json 的配置来部署 Pages 和 Functions
tccli edgeone deploy --project-name cloze_test
```

## 部署验证

部署完成后，使用以下命令验证API端点是否正常工作：

```bash
# 测试翻译API
curl -X POST -H "Content-Type: application/json" -d '{"text":"test","from":"en","to":"zh"}' https://your-deployment-url/api/translate

# 测试单词查询API
curl -X POST -H "Content-Type: application/json" -d '{"word":"test"}' https://your-deployment-url/api/word-query
```

## 常见问题排查

1. **405错误**：确保API只使用POST方法访问
2. **500错误**：检查环境变量配置是否正确（特别是`TENCENT_APP_ID`和`TENCENT_APP_KEY`），查看函数日志
3. **跨域问题**：确认CORS配置是否正确应用
4. **函数未找到**：检查edgeone.json中的路由配置是否正确
5. **腾讯翻译API错误**：如果遇到腾讯翻译API相关错误，请检查环境变量是否正确、API密钥权限以及调用频率限制。系统会在腾讯API调用失败时自动尝试使用备用的百度翻译或火山AI服务

## 注意事项

- 部署前确保所有环境变量已正确配置
- 定期检查函数日志，监控API调用情况
- 如有问题，请参考 `docs/api_405_error` 目录下的问题分析文档