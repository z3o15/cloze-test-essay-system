# 项目部署指南

## 部署准备

### 已完成步骤
- ✅ 项目构建成功，构建文件位于 `dist` 目录
- ✅ EdgeOne Pages配置文件 `edgeone.json` 已配置
- ✅ 边缘函数已编写完成，位于 `edge-functions` 目录

## EdgeOne Pages部署步骤

### 1. 部署环境变量配置

在EdgeOne Pages控制台中设置以下环境变量：

### 1.1 腾讯翻译API配置（主要服务）
- `TENCENT_APP_ID`: 腾讯翻译君的App ID
- `TENCENT_APP_KEY`: 腾讯翻译君的App密钥
- `TENCENT_TRANSLATE_URL`: 腾讯翻译API地址（可选，默认值：https://api.ai.qq.com/fcgi-bin/nlp/nlp_texttranslate）
- `TENCENT_DICT_URL`: 腾讯词典API地址（可选，默认值：https://api.ai.qq.com/fcgi-bin/nlp/nlp_worddict）

### 1.2 备用服务配置
- `BAIDU_APP_ID`: 百度翻译API的App ID（备用）
- `BAIDU_SECRET_KEY`: 百度翻译API的密钥（备用）
- `VOLCANO_API_KEY`: 火山AI的API密钥（备用翻译服务）
- `VOLCANO_API_URL`: 火山AI的API地址

### 1.3 数据存储配置
- `KV_URL`: KV存储地址
- `KV_REST_API_URL`: KV REST API地址
- `KV_REST_API_TOKEN`: KV REST API令牌
- `KV_REST_API_READ_ONLY_TOKEN`: KV REST API只读令牌

### 2. 部署方式

#### 方式一：通过EdgeOne Pages控制台部署
1. 访问EdgeOne Pages控制台
2. 创建新项目或选择现有项目
3. 上传dist目录内容
4. 确保edge-functions目录被正确包含
5. 配置环境变量
6. 触发部署

#### 方式二：通过EdgeOne CLI部署（推荐）
```bash
# 安装EdgeOne CLI（如果尚未安装）
npm install -g @cloudflare/wrangler

# 登录EdgeOne
tencentcloud edgeone login

# 部署项目
tencentcloud edgeone pages deploy dist --name cloze_test
```

## 部署验证

部署完成后，使用以下命令验证API端点是否正常工作：

```bash
# 测试翻译API
curl -X POST -H "Content-Type: application/json" -d '{"text":"test","from":"en","to":"zh"}' https://your-deployment-url/api/translate

# 测试单词查询API
curl -X POST -H "Content-Type: application/json" -d '{"word":"test"}' https://your-deployment-url/api/word-query
```

## 常见问题排查

1. **405错误**：确保API只使用POST方法访问
2. **500错误**：检查环境变量配置是否正确（特别是`TENCENT_APP_ID`和`TENCENT_APP_KEY`），查看函数日志
3. **跨域问题**：确认CORS配置是否正确应用
4. **函数未找到**：检查edgeone.json中的路由配置是否正确
5. **腾讯翻译API错误**：如果遇到腾讯翻译API相关错误，请检查环境变量是否正确、API密钥权限以及调用频率限制。系统会在腾讯API调用失败时自动尝试使用备用的百度翻译或火山AI服务

## 注意事项

- 部署前确保所有环境变量已正确配置
- 定期检查函数日志，监控API调用情况
- 如有问题，请参考 `docs/api_405_error` 目录下的问题分析文档