# 🔌 接口文档

## 一、通用说明
- **基础URL**: `/api/v1/`
- **认证方式**: 暂无（后续可扩展Token认证）
- **数据格式**: JSON
- **字符编码**: UTF-8
- **请求头**: `Content-Type: application/json`

## 二、接口列表

### 2.1 翻译相关接口
| 接口名 | 方法 | URL | 权限 | 说明 |
|--------|------|-----|------|------|
| 基础翻译 | POST | /translate | 公开 | 基础文本翻译功能 |
| 批量翻译 | POST | /translate/batch | 公开 | 批量翻译多个段落 |
| 增强段落翻译 | POST | /enhanced/paragraph | 公开 | 翻译英文段落并提取单词 |
| 翻译历史 | GET | /translate/history | 公开 | 获取翻译记录 |
| 清除缓存 | POST | /translate/cache/clear | 公开 | 清除翻译缓存 |
| ~~翻译统计~~ | ~~GET~~ | ~~/translate/stats~~ | ~~公开~~ | **已移除** - 非核心功能 |

### 2.2 文章处理接口
| 接口名 | 方法 | URL | 权限 | 说明 |
|--------|------|-----|------|------|
| 文章处理 | POST | /essay/process | 公开 | 处理完整文章，分段翻译并提取单词 |

### 2.3 AI单词处理接口 ⭐
| 接口名 | 方法 | URL | 权限 | 说明 |
|--------|------|-----|------|------|
| AI服务配置状态 | GET | /ai-words/config-status | 公开 | 检查AI服务配置状态 |
| 单个单词AI处理 | POST | /ai-words/process-single | 公开 | 单个单词AI智能处理 |
| 批量单词AI处理 | POST | /ai-words/batch-process | 公开 | 批量单词AI智能处理 |
| 过滤复杂单词 | POST | /ai-words/filter-complex | 公开 | 过滤难度≥5的复杂单词 |
| 检查翻译必要性 | POST | /ai-words/check-translation | 公开 | 检查单词是否需要显示翻译 |

### 2.4 单词管理接口
| 接口名 | 方法 | URL | 权限 | 说明 |
|--------|------|-----|------|------|
| 单词查询 | GET | /word/:word | 公开 | 从数据库匹配单词翻译 |
| 单词预查询 | GET | /words/pre-query/:word | 公开 | 优化的单词查询接口 |
| 健康检查 | GET | /health | 公开 | 服务状态检查 |

## 三、接口详情

### 3.1 翻译接口

#### POST /enhanced/paragraph
**功能**: 翻译英文段落并提取单词（已实现）

**请求参数**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| text | string | ✅ | 待翻译的英文段落 |
| source_lang | string | ❌ | 源语言，默认'en' |
| target_lang | string | ❌ | 目标语言，默认'zh' |

**请求示例**
```json
{
  "text": "This is a sample paragraph for translation.",
  "source_lang": "en",
  "target_lang": "zh"
}
```

**响应示例**
```json
{
  "code": "SUCCESS",
  "data": {
    "original": "This is a sample paragraph for translation.",
    "translated": "这是一个用于翻译的示例段落。",
    "cached": false
  },
  "message": "翻译成功"
}
```

#### POST /translate
**功能**: 基础翻译功能

#### POST /translate/batch
**功能**: 批量翻译

### 3.2 AI单词处理接口 ⭐

#### GET /ai-words/config-status
**功能**: 检查AI服务配置状态

**响应示例**
```json
{
  "success": true,
  "data": {
    "aiServiceAvailable": false,
    "fallbackMode": "rules",
    "configStatus": "AI服务未配置，使用基础规则判断"
  },
  "message": "配置状态检查完成"
}
```

#### POST /ai-words/process
**功能**: 单个单词AI智能处理

**请求参数**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| word | string | ✅ | 要处理的英文单词 |

**请求示例**
```json
{
  "word": "sophisticated"
}
```

**响应示例**
```json
{
  "success": true,
  "data": {
    "word": "sophisticated",
    "pronunciation": "/səˈfɪstɪkeɪtɪd/",
    "definition": "having great knowledge or experience",
    "translation": "复杂的，精密的",
    "partOfSpeech": "adjective",
    "difficultyLevel": 6,
    "frequencyRank": null,
    "exampleSentences": null,
    "synonyms": null,
    "antonyms": null,
    "etymology": null,
    "isActive": true,
    "aiJudgment": "使用基础规则判断（AI服务不可用）"
  },
  "message": "AI单词处理成功"
}
```

#### POST /ai-words/batch-process
**功能**: 批量单词AI智能处理

**请求参数**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| words | string[] | ✅ | 要处理的英文单词数组 |

**请求示例**
```json
{
  "words": ["dog", "elephant", "sophisticated", "beautiful"]
}
```

**响应示例**
```json
{
  "success": true,
  "data": [
    {
      "word": "dog",
      "pronunciation": "/dɔːɡ/",
      "definition": "a domesticated carnivorous mammal",
      "translation": "狗",
      "partOfSpeech": "noun",
      "difficultyLevel": 1,
      "aiJudgment": "使用基础规则判断（AI服务不可用）"
    },
    {
      "word": "sophisticated",
      "pronunciation": "/səˈfɪstɪkeɪtɪd/",
      "definition": "having great knowledge or experience",
      "translation": "复杂的，精密的",
      "partOfSpeech": "adjective", 
      "difficultyLevel": 6,
      "aiJudgment": "使用基础规则判断（AI服务不可用）"
    }
  ],
  "message": "批量AI处理完成，共处理 4 个单词"
}
```

#### POST /ai-words/filter-complex
**功能**: 过滤复杂单词（难度≥5）

**请求参数**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| words | string[] | ✅ | 要过滤的英文单词数组 |

**请求示例**
```json
{
  "words": ["cat", "dog", "sophisticated", "beautiful", "extraordinary", "simple"]
}
```

**响应示例**
```json
{
  "success": true,
  "data": {
    "complexWords": ["sophisticated", "beautiful", "extraordinary"],
    "totalCount": 6,
    "complexCount": 3
  },
  "message": "过滤完成，找到 3 个复杂单词"
}
```

#### POST /ai-words/check-translation
**功能**: 检查单词翻译必要性

**请求参数**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| word | string | ✅ | 英文单词 |
| translation | string | ✅ | 中文翻译 |

**请求示例**
```json
{
  "word": "sophisticated",
  "translation": "复杂的"
}
```

**响应示例**
```json
{
  "success": true,
  "data": {
    "word": "sophisticated",
    "translation": "复杂",
    "needsTranslation": true,
    "difficultyLevel": 6,
    "reason": "复杂单词建议显示翻译"
  },
  "message": "翻译检查完成"
}
```

### 3.3 单词管理接口

#### GET /word/:word
**路径参数**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| word | string | ✅ | 要查询的英文单词 |

**响应示例**
```json
{
  "code": "SUCCESS",
  "data": {
    "english": "example",
    "chinese": "例子，示例",
    "found": true,
    "source": "database"
  }
}
```

## 四、错误码规范

### 4.1 通用错误码
| 错误码 | 说明 | HTTP状态码 |
|--------|------|------------|
| SUCCESS | 请求成功 | 200 |
| ERROR_001 | 参数缺失或格式错误 | 400 |
| ERROR_002 | 翻译服务异常 | 500 |
| ERROR_003 | 数据库连接失败 | 500 |
| ERROR_004 | API配额不足 | 429 |
| **ERROR_005** | **AI服务异常** | **500** |
| ERROR_500 | 服务器内部错误 | 500 |

### 4.2 错误响应格式
```json
{
  "success": false,
  "error": {
    "code": "ERROR_001",
    "message": "参数缺失：word字段为必填项",
    "details": "请检查请求参数格式"
  },
  "timestamp": "2024-12-24T10:00:00Z"
}
```

## 五、请求限制

### 5.1 频率限制
| 接口类型 | 限制 | 时间窗口 |
|----------|------|----------|
| 单词处理 | 100次/分钟 | 60秒 |
| 批量处理 | 10次/分钟 | 60秒 |
| 翻译接口 | 50次/分钟 | 60秒 |
| 查询接口 | 200次/分钟 | 60秒 |

### 5.2 数据限制
| 参数 | 限制 |
|------|------|
| 单词长度 | 1-50字符 |
| 批量处理数量 | 最多50个单词 |
| 段落长度 | 最多5000字符 |

## 六、响应时间标准

| 接口类型 | 目标响应时间 | 最大响应时间 |
|----------|--------------|--------------|
| 配置检查 | <100ms | 500ms |
| 单词处理 | <300ms | 1000ms |
| 批量处理 | <1000ms | 3000ms |
| 复杂过滤 | <500ms | 1500ms |
| 翻译检查 | <200ms | 800ms |

## 七、测试用例

### 7.1 正常场景测试
```bash
# 单词处理测试
curl -X POST http://localhost:3000/api/v1/ai-words/process \
  -H "Content-Type: application/json" \
  -d '{"word": "sophisticated"}'

# 批量处理测试  
curl -X POST http://localhost:3000/api/v1/ai-words/batch-process \
  -H "Content-Type: application/json" \
  -d '{"words": ["cat", "sophisticated", "beautiful"]}'

# 复杂单词过滤测试
curl -X POST http://localhost:3000/api/v1/ai-words/filter-complex \
  -H "Content-Type: application/json" \
  -d '{"words": ["cat", "dog", "sophisticated", "extraordinary"]}'
```

### 7.2 异常场景测试
```bash
# 参数缺失测试
curl -X POST http://localhost:3000/api/v1/ai-words/process \
  -H "Content-Type: application/json" \
  -d '{}'

# 无效单词测试
curl -X POST http://localhost:3000/api/v1/ai-words/process \
  -H "Content-Type: application/json" \
  -d '{"word": ""}'

# 超长数组测试
curl -X POST http://localhost:3000/api/v1/ai-words/batch-process \
  -H "Content-Type: application/json" \
  -d '{"words": ["word1", "word2", ..., "word100"]}'
```

## 八、版本管理

### 8.1 API版本
- **当前版本**: v1
- **版本路径**: `/api/v1/`
- **向后兼容**: 保证v1版本稳定性

### 8.2 更新日志
| 版本 | 日期 | 更新内容 |
|------|------|----------|
| v1.0 | 2024-12-24 | 初始版本，基础翻译功能 |
| v1.1 | 2024-12-24 | 新增AI单词处理功能模块 |
| v1.2 | 2024-12-24 | **功能优化**: 移除翻译统计模块，简化系统复杂度；修复火山翻译API级别匹配问题 |

## 九、SDK示例

### 9.1 JavaScript SDK
```javascript
class ClozeTestAPI {
  constructor(baseURL = 'http://localhost:3000/api/v1') {
    this.baseURL = baseURL;
  }
  
  // AI单词处理
  async processWord(word) {
    const response = await fetch(`${this.baseURL}/ai-words/process`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ word })
    });
    return response.json();
  }
  
  // 批量处理
  async batchProcess(words) {
    const response = await fetch(`${this.baseURL}/ai-words/batch-process`, {
      method: 'POST', 
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ words })
    });
    return response.json();
  }
}

// 使用示例
const api = new ClozeTestAPI();
const result = await api.processWord('sophisticated');
console.log(result);
```