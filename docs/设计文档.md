# ğŸ—ï¸ è®¾è®¡æ–‡æ¡£

## ä¸€ã€ç³»ç»Ÿæ¶æ„å›¾
```mermaid
flowchart LR
    User[ç”¨æˆ·] --> Frontend[Vue3å‰ç«¯]
    Frontend --> API[Express APIå±‚]
    API --> Service[ä¸šåŠ¡æœåŠ¡å±‚]
    Service --> Cache[(Redisç¼“å­˜)]
    Service --> DB[(PostgreSQL)]
    Service --> External[è…¾è®¯äº‘ç¿»è¯‘API]
    
    subgraph "å‰ç«¯å±‚"
        Frontend --> Router[Vue Router]
        Frontend --> Store[PiniaçŠ¶æ€ç®¡ç†]
        Frontend --> UI[Vant UIç»„ä»¶]
    end
    
    subgraph "åç«¯å±‚"
        API --> Auth[è®¤è¯ä¸­é—´ä»¶]
        API --> Rate[é™æµä¸­é—´ä»¶]
        Service --> Translation[ç¿»è¯‘æœåŠ¡+å•è¯æå–]
        Service --> AIWord[AIå•è¯å¤„ç†æœåŠ¡]
        Service --> Word[å•è¯åŒ¹é…æœåŠ¡]
        Service --> Essay[æ–‡ç« æœåŠ¡]
    end
    
    subgraph "AIå•è¯å¤„ç†æ¨¡å— â­ å·²å®ç°"
        AIWord --> Difficulty[ç«å±±å¼•æ“AIéš¾åº¦åˆ¤æ–­]
        AIWord --> Filter[å¤æ‚å•è¯è¿‡æ»¤å™¨]
        AIWord --> Batch[æ‰¹é‡å¤„ç†å™¨]
        AIWord --> Cache[å¤šå±‚ç¼“å­˜æœºåˆ¶]
        Difficulty --> VolcanoAI[ç«å±±å¼•æ“API]
        Cache --> Redis[(Redisç¼“å­˜)]
        Cache --> DBCache[(æ•°æ®åº“ç¼“å­˜)]
    end
```

## äºŒã€æ¨¡å—è®¾è®¡

### 2.1 æ ¸å¿ƒæ¨¡å—
| æ¨¡å—å | èŒè´£è¯´æ˜ | ä¸»è¦ç±»/æ–¹æ³• |
|--------|----------|-------------|
| TranslationService | å¤„ç†æ®µè½ç¿»è¯‘ä¸ç¼“å­˜ | translateParagraph(), getCachedTranslation() |
| **SimplifiedWordService** â­ | **AIå•è¯æ™ºèƒ½å¤„ç†ï¼ˆå·²å®ç°ï¼‰** | **processWord(), batchProcessWords(), filterComplexWords()** |
| WordService | å•è¯æ•°æ®ç®¡ç† | getWordFromDatabase(), saveWord() |
| EssayService | æ–‡ç« ç®¡ç†å’Œå­˜å‚¨ | saveEssay(), getEssayList() |
| ThemeService | ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ | toggleTheme(), applyTheme() |

### 2.2 å·²ç§»é™¤æ¨¡å— ğŸ—‘ï¸
| æ¨¡å—å | ç§»é™¤åŸå›  | ç§»é™¤æ—¥æœŸ |
|--------|----------|----------|
| **TranslationStatsService** | **éæ ¸å¿ƒåŠŸèƒ½ï¼Œç®€åŒ–ç³»ç»Ÿå¤æ‚åº¦** | **2024-12-XX** |
| **RealTimeProgressService** | **å®æ—¶æç¤ºåŠŸèƒ½å½±å“ç”¨æˆ·ä½“éªŒ** | **2024-12-XX** |

### 2.3 AIå•è¯å¤„ç†æ¨¡å—è¯¦ç»†è®¾è®¡

#### 2.3.1 EnhancedWordService
```typescript
class EnhancedWordService {
  // å•ä¸ªå•è¯AIå¤„ç†
  async processWord(word: string): Promise<AIWordResult>
  
  // æ‰¹é‡å•è¯å¤„ç†
  async batchProcess(words: string[]): Promise<AIWordResult[]>
  
  // å¤æ‚å•è¯è¿‡æ»¤
  async filterComplexWords(words: string[]): Promise<string[]>
  
  // ç¿»è¯‘å¿…è¦æ€§æ£€æŸ¥
  async checkTranslationNeed(word: string, translation: string): Promise<boolean>
  
  // é…ç½®çŠ¶æ€æ£€æŸ¥
  async getConfigStatus(): Promise<ConfigStatus>
}
```

#### 2.3.2 WordDifficultyJudgeï¼ˆéš¾åº¦åˆ¤æ–­å¼•æ“ï¼‰
```typescript
class WordDifficultyJudge {
  // åŸºäºè§„åˆ™çš„éš¾åº¦åˆ¤æ–­
  judgeByRules(word: string): number
  
  // AIæœåŠ¡éš¾åº¦åˆ¤æ–­ï¼ˆé¢„ç•™æ¥å£ï¼‰
  async judgeByAI(word: string): Promise<number>
  
  // ç»¼åˆåˆ¤æ–­
  async judge(word: string): Promise<DifficultyResult>
}
```

#### 2.3.3 åˆ¤æ–­è§„åˆ™ç®—æ³•
```typescript
// éš¾åº¦åˆ¤æ–­è§„åˆ™
const DIFFICULTY_RULES = {
  // åŸºç¡€è§„åˆ™ï¼šå•è¯é•¿åº¦
  lengthRules: {
    1-3: 1,    // æç®€å•
    4-5: 2-3,  // ç®€å•
    6-8: 4-6,  // ä¸­ç­‰
    9-12: 7-8, // å›°éš¾
    13+: 9-10  // æå›°éš¾
  },
  
  // å¸¸ç”¨è¯æ±‡è§„åˆ™
  commonWords: {
    high: -2,    // é«˜é¢‘è¯é™ä½éš¾åº¦
    medium: 0,   // ä¸­é¢‘è¯ä¸å˜
    low: +2      // ä½é¢‘è¯å¢åŠ éš¾åº¦
  },
  
  // è¯æ€§è§„åˆ™
  partOfSpeech: {
    noun: 0,
    verb: +1,
    adjective: +1,
    adverb: +2
  }
}
```

## ä¸‰ã€æ•°æ®åº“è®¾è®¡

### 3.1 æ ¸å¿ƒè¡¨ç»“æ„
| è¡¨å | å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|------|
| **words** | id | serial | ä¸»é”® |
| **words** | word | varchar(100) | è‹±æ–‡å•è¯ |
| **words** | pronunciation | varchar(100) | å‘éŸ³ |
| **words** | **definition** â­ | text | **è‹±æ–‡å®šä¹‰** |
| **words** | translation | varchar(200) | ä¸­æ–‡ç¿»è¯‘ |
| **words** | **part_of_speech** â­ | varchar(50) | **è¯æ€§** |
| **words** | **difficulty_level** â­ | integer | **éš¾åº¦ç­‰çº§(1-10)** |
| **words** | **frequency_rank** â­ | integer | **è¯é¢‘æ’å** |
| **words** | **example_sentences** â­ | text | **ä¾‹å¥** |
| **words** | **synonyms** â­ | text | **åŒä¹‰è¯** |
| **words** | **antonyms** â­ | text | **åä¹‰è¯** |
| **words** | **etymology** â­ | text | **è¯æº** |
| **words** | **is_active** â­ | boolean | **æ˜¯å¦æ´»è·ƒ** |
| **words** | created_at | timestamp | åˆ›å»ºæ—¶é—´ |
| **words** | updated_at | timestamp | æ›´æ–°æ—¶é—´ |

### 3.2 ç´¢å¼•è®¾è®¡
```sql
-- å•è¯æŸ¥è¯¢ç´¢å¼•
CREATE INDEX idx_words_word ON words(word);

-- éš¾åº¦ç­‰çº§ç´¢å¼•
CREATE INDEX idx_words_difficulty ON words(difficulty_level);

-- è¯é¢‘æ’åç´¢å¼•
CREATE INDEX idx_words_frequency ON words(frequency_rank);

-- å¤åˆç´¢å¼•ï¼šæ´»è·ƒçŠ¶æ€+éš¾åº¦
CREATE INDEX idx_words_active_difficulty ON words(is_active, difficulty_level);
```

## å››ã€APIè®¾è®¡æ¶æ„

### 4.1 è·¯ç”±å±‚æ¬¡ç»“æ„
```
/api/v1/
â”œâ”€â”€ /translate/          # ç¿»è¯‘ç›¸å…³
â”‚   â”œâ”€â”€ /paragraph       # æ®µè½ç¿»è¯‘
â”‚   â””â”€â”€ /history         # ç¿»è¯‘å†å²
â”œâ”€â”€ /ai-words/          # AIå•è¯å¤„ç† â­
â”‚   â”œâ”€â”€ /process        # å•ä¸ªå•è¯å¤„ç†
â”‚   â”œâ”€â”€ /batch-process  # æ‰¹é‡å¤„ç†
â”‚   â”œâ”€â”€ /filter-complex # å¤æ‚å•è¯è¿‡æ»¤
â”‚   â”œâ”€â”€ /check-translation # ç¿»è¯‘æ£€æŸ¥
â”‚   â””â”€â”€ /config-status  # é…ç½®çŠ¶æ€
â”œâ”€â”€ /words/             # å•è¯ç®¡ç†
â”‚   â”œâ”€â”€ /:word          # å•è¯æŸ¥è¯¢
â”‚   â””â”€â”€ /search         # å•è¯æœç´¢
â””â”€â”€ /health             # å¥åº·æ£€æŸ¥
```

### 4.2 ä¸­é—´ä»¶æ¶æ„
```typescript
// è¯·æ±‚å¤„ç†æµç¨‹
Request â†’ CORS â†’ RateLimit â†’ Validation â†’ Controller â†’ Service â†’ Repository â†’ Database
                                    â†“
                              ErrorHandler â†’ Response
```

## äº”ã€å¼‚å¸¸ä¸å¹¶å‘å¤„ç†

### 5.1 é”™è¯¯å¤„ç†ç­–ç•¥
```typescript
// ç»Ÿä¸€é”™è¯¯ç 
enum ErrorCode {
  SUCCESS = "SUCCESS",
  PARAM_ERROR = "ERROR_001",
  TRANSLATION_ERROR = "ERROR_002", 
  DATABASE_ERROR = "ERROR_003",
  API_QUOTA_ERROR = "ERROR_004",
  AI_SERVICE_ERROR = "ERROR_005", // æ–°å¢
  INTERNAL_ERROR = "ERROR_500"
}
```

### 5.2 å¹¶å‘å¤„ç†
- **æ‰¹é‡å¤„ç†å¹¶å‘æ§åˆ¶**: ä½¿ç”¨Promise.allSettledé™åˆ¶å¹¶å‘æ•°é‡
- **æ•°æ®åº“è¿æ¥æ± **: PostgreSQLè¿æ¥æ± ç®¡ç†
- **Redisé”æœºåˆ¶**: é˜²æ­¢é‡å¤å¤„ç†ç›¸åŒå•è¯
- **APIé™æµ**: express-rate-limitä¸­é—´ä»¶

### 5.3 ç¼“å­˜ç­–ç•¥
```typescript
// ç¼“å­˜å±‚æ¬¡
L1: å†…å­˜ç¼“å­˜ (å•è¯åŸºç¡€ä¿¡æ¯, TTL: 1å°æ—¶)
L2: Redisç¼“å­˜ (ç¿»è¯‘ç»“æœ, TTL: 24å°æ—¶)  
L3: æ•°æ®åº“ (æŒä¹…åŒ–å­˜å‚¨)
```

## å…­ã€æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 6.1 æ•°æ®åº“ä¼˜åŒ–
- åˆç†çš„ç´¢å¼•è®¾è®¡
- æŸ¥è¯¢è¯­å¥ä¼˜åŒ–
- è¿æ¥æ± é…ç½®
- è¯»å†™åˆ†ç¦»ï¼ˆé¢„ç•™ï¼‰

### 6.2 ç¼“å­˜ä¼˜åŒ–
- å¤šçº§ç¼“å­˜ç­–ç•¥
- ç¼“å­˜é¢„çƒ­æœºåˆ¶
- ç¼“å­˜å¤±æ•ˆç­–ç•¥
- ç¼“å­˜ç©¿é€é˜²æŠ¤

### 6.3 APIä¼˜åŒ–
- æ‰¹é‡å¤„ç†å‡å°‘è¯·æ±‚æ¬¡æ•°
- å“åº”æ•°æ®å‹ç¼©
- å¼‚æ­¥å¤„ç†é•¿æ—¶é—´ä»»åŠ¡
- è¯·æ±‚å»é‡æœºåˆ¶

## ä¸ƒã€å®‰å…¨è®¾è®¡

### 7.1 è¾“å…¥éªŒè¯
- å‚æ•°ç±»å‹æ£€æŸ¥
- é•¿åº¦é™åˆ¶
- ç‰¹æ®Šå­—ç¬¦è¿‡æ»¤
- SQLæ³¨å…¥é˜²æŠ¤

### 7.2 APIå®‰å…¨
- è¯·æ±‚é¢‘ç‡é™åˆ¶
- è·¨åŸŸé…ç½®
- æ•æ„Ÿä¿¡æ¯è„±æ•
- æ—¥å¿—å®‰å…¨è®°å½•

## å…«ã€ç›‘æ§ä¸æ—¥å¿—

### 8.1 æ—¥å¿—è®¾è®¡
```typescript
// æ—¥å¿—çº§åˆ«
enum LogLevel {
  ERROR = "error",
  WARN = "warn", 
  INFO = "info",
  DEBUG = "debug"
}

// æ—¥å¿—æ ¼å¼
{
  timestamp: "2024-12-24T10:00:00Z",
  level: "info",
  service: "ai-word-service",
  action: "process_word",
  word: "sophisticated",
  duration: 120,
  result: "success"
}
```

### 8.2 æ€§èƒ½ç›‘æ§
- APIå“åº”æ—¶é—´ç›‘æ§
- æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
- ç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡
- é”™è¯¯ç‡ç›‘æ§

## ä¹ã€æ‰©å±•æ€§è®¾è®¡

### 9.1 AIæœåŠ¡æ‰©å±•
- æ”¯æŒå¤šç§AIæœåŠ¡æä¾›å•†
- æœåŠ¡é™çº§å’Œå®¹é”™
- é…ç½®åŒ–AIæ¨¡å‹é€‰æ‹©
- A/Bæµ‹è¯•æ”¯æŒ

### 9.2 åŠŸèƒ½æ‰©å±•
- ç”¨æˆ·ä¸ªæ€§åŒ–éš¾åº¦è°ƒæ•´
- å­¦ä¹ è¿›åº¦è·Ÿè¸ª
- æ™ºèƒ½æ¨èç®—æ³•
- å¤šè¯­è¨€æ”¯æŒ