# 翻译服务实现共识文档

## 需求描述

实现直接调用腾讯词典API和火山AI API的功能，移除对EdgeOne Pages边缘函数的依赖，同时确保不同翻译服务返回的结果格式一致，便于前端统一处理。

## 验收标准

1. ✅ 移除所有对边缘函数的依赖，直接在前端代码中调用各翻译API
2. ✅ 实现腾讯词典API的直接调用，包括签名生成和响应解析
3. ✅ 实现火山AI API的直接调用，确保功能与原有通过边缘函数调用时一致
4. ✅ 实现百度翻译API的直接调用，作为最后的备用方案
5. ✅ 实现统一的响应格式处理函数，确保不同服务返回的数据结构一致
6. ✅ 保持现有的缓存机制和本地词典功能
7. ✅ 实现健壮的错误处理和超时控制，每个API调用设置3秒超时
8. ✅ 按腾讯→火山→百度的顺序尝试调用，任一成功则返回结果
9. ✅ 所有API密钥通过环境变量管理，不硬编码在代码中
10. ✅ 保持现有的API调用接口不变，确保前端调用逻辑无需修改

## 技术实现方案

### 架构调整

1. **移除边缘函数依赖**：删除对`/api/word-query`路由的调用，不再依赖EdgeOne Pages边缘函数
2. **直接API调用**：在前端代码中直接调用腾讯词典API、火山AI API和百度翻译API
3. **统一响应处理**：实现响应格式统一函数，标准化不同API的返回结果

### 核心技术点

1. **腾讯词典API调用**：
   - 实现API签名生成（使用MD5加密）
   - 处理API响应，提取音标、释义和例句
   - 设置请求超时控制

2. **火山AI API调用**：
   - 使用已验证可用的API参数和提示词格式
   - 实现响应解析，提取音标和释义
   - 设置请求超时控制

3. **百度翻译API调用**：
   - 实现API签名生成
   - 处理简单的翻译响应
   - 作为最后的备用方案

4. **统一响应格式**：
   - 实现`normalizeTranslationResponse`函数
   - 确保返回的对象符合`WordInfo`接口定义
   - 处理空值和异常情况

### 错误处理策略

1. **API密钥检查**：在调用前检查API密钥是否配置
2. **超时控制**：每个API调用设置3秒超时
3. **服务降级**：按腾讯→火山→百度的顺序尝试，任一失败则尝试下一个
4. **错误日志**：记录详细的错误信息，便于调试
5. **默认响应**：所有API都失败时返回友好的错误信息

## 集成方案

1. **修改现有代码**：更新`src/utils/api.ts`文件，替换现有的API调用逻辑
2. **环境变量配置**：确保`.env`文件中包含所有必要的API密钥
3. **缓存机制**：保持现有的缓存逻辑不变，仅修改数据获取方式

## 任务边界限制

1. 仅修改单词查询相关功能，不影响其他模块
2. 不修改现有的API调用接口，保持向后兼容
3. 不涉及UI或用户交互的修改
4. 不修改缓存机制和本地词典功能

通过上述方案，可以在不使用边缘函数的情况下，实现直接调用各翻译API的功能，并确保返回结果的格式一致性，满足用户需求。